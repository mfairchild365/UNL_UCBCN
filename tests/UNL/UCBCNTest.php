<?php
// Call UNL_UCBCNTest::main() if this source file is executed directly.
if (!defined("PHPUnit_MAIN_METHOD")) {
    define("PHPUnit_MAIN_METHOD", "UNL_UCBCNTest::main");
}

require_once "PHPUnit/Framework/TestCase.php";
require_once "PHPUnit/Framework/TestSuite.php";

require_once 'UNL/UCBCN.php';

/**
 * Test class for UNL_UCBCN.
 * Generated by PHPUnit_Util_Skeleton on 2006-11-17 at 11:33:46.
 */
class UNL_UCBCNTest extends PHPUnit_Framework_TestCase {
    
    public $dsn = 'sqlite:///events';
    
    /**
     * UNL_UCBCN backend system
     *
     * @var object
     */
    public $b;
    
    /**
     * Runs the test methods of this class.
     *
     * @access public
     * @static
     */
    public static function main() {
        require_once "PHPUnit/TextUI/TestRunner.php";

        $suite  = new PHPUnit_Framework_TestSuite("UNL_UCBCNTest");
        $result = PHPUnit_TextUI_TestRunner::run($suite);
    }

    /**
     * Sets up the fixture, for example, open a network connection.
     * This method is called before a test is executed.
     *
     * @access protected
     */
    protected function setUp() {
       $this->b = new UNL_UCBCN(array('dsn'=>$this->dsn));
    }

    /**
     * Tears down the fixture, for example, close a network connection.
     * This method is called after a test is executed.
     *
     * @access protected
     */
    protected function tearDown() {
    }

    /**
     * Finished.
     */
    public function testSetupDBConn() {
        $this->b->setupDBconn();
        $dboptions = &PEAR::getStaticProperty('DB_DataObject','options');
        $this->assertEquals($dboptions['database'],$this->dsn);
    }

    /**
     * Finished.
     */
    public function testSetOptions() {
        global $_UNL_UCBCN;
        $test = new UNL_UCBCN(array('dsn'=>$this->dsn,'template'=>'davey'));
        // Test that value was set.
        $this->assertEquals($test->dsn,$this->dsn);
        $this->assertEquals($test->template,'davey');
        // Test that setOptions correctly set a global variable.
        $this->assertEquals($_UNL_UCBCN['template'],'davey');
    }

    /**
     * @todo Implement testGetEventCount().
     */
    public function testGetEventCount() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testFactory().
     */
    public function testFactory() {
        
        $a = $this->b->factory('account');
        
        $this->assertEquals(get_class($a),'UNL_UCBCN_Account');
    }

    /**
     * Checks the getUser() function.
     */
    public function testGetUser() {
        $u = $this->b->getUser('myuser');
        $this->assertEquals(get_class($u),'UNL_UCBCN_User');
        $this->assertEquals($u->uid,'myuser');
    }
    
    /**
     * @todo Implement testCreateUser().
     */
    public function testCreateUser() {
        
    	$a = $this->b->factory('account');
    	$a->find();
    	$a->fetch();
    	$u = $this->b->createUser($a,'foo');
    	$this->assertEquals($u->uid,'foo');
    	$u->delete();
    }

    /**
     * @todo Implement testDbInsert().
     */
    public function testDbInsert() {
    	$values = array(
			'account_id'		=> 1,
			'uid' 				=> 'bar',
		    'calendar_id'       => 0,
			'datecreated'		=> date('Y-m-d H:i:s'),
			'uidcreated'		=> 'foo',
			'datelastupdated' 	=> date('Y-m-d H:i:s'),
			'uidlastupdated'	=> 'foo');
		$res = $this->b->dbInsert('user',$values);
		$this->assertEquals($res->uid,'bar');
		$res->delete();
    }

    /**
     * @todo Implement testUserHasPermission().
     */
    public function testUserHasPermission() {
    	
    	$u = $this->b->getUser('myuser');
    	$a = $this->b->getAccount($u);
    	$c = $this->b->getCalendar($u,$a,true);
    	$this->assertEquals($this->b->userHasPermission($u,'Event Create',$c),true);
    	$c->removeUser($u);
    	$this->assertEquals($this->b->userHasPermission($u,'Event Create',$c),false);
    	$c->addUser($u);
    	$this->assertEquals($this->b->userHasPermission($u,'Event Create',$c),true);
    }

    /**
     * @todo Implement testShowError().
     */
    public function testShowError() {
    	flush();
    	ob_start();
    	$this->b->showError('HAHAHA!');
    	$this->assertEquals('HAHAHA!',ob_get_clean());
    	ob_end_clean();
    }

    /**
     * @todo Implement testDisplayRegion().
     */
    public function testDisplayRegion() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testSendObjectOutput().
     */
    public function testSendObjectOutput() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGrantPermission().
     */
    public function testGrantPermission() {
    	$r = $this->b->grantPermission('foo',1,1);
    	$this->assertEquals($r->user_uid,'foo');
    	$r->delete();
    }

    /**
     * @todo Implement testCreateAccount().
     */
    public function testCreateAccount() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testAddCalendarHasEvent().
     */
    public function testAddCalendarHasEvent() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testCalendarHasEvent().
     */
    public function testCalendarHasEvent() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGetAccount().
     */
    public function testGetAccount() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGetCalendar().
     */
    public function testGetCalendar() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testCreateCalendar().
     */
    public function testCreateCalendar() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testLocalRedirect().
     */
    public function testLocalRedirect() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGetAbsoluteURL().
     */
    public function testGetAbsoluteURL() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGetTemplateFilename().
     */
    public function testGetTemplateFilename() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGetDatabaseConnection().
     */
    public function testGetDatabaseConnection() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testOutputTemplate().
     */
    public function testOutputTemplate() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testGetURL().
     */
    public function testGetURL() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testArchiveEvents().
     */
    public function testArchiveEvents() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testCleanCache().
     */
    public function testCleanCache() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }

    /**
     * @todo Implement testUserCanEditEvent().
     */
    public function testUserCanEditEvent() {
        // Remove the following line when you implement this test.
        $this->markTestIncomplete(
          "This test has not been implemented yet."
        );
    }
}

// Call UNL_UCBCNTest::main() if this source file is executed directly.
if (PHPUnit_MAIN_METHOD == "UNL_UCBCNTest::main") {
    UNL_UCBCNTest::main();
}
?>
